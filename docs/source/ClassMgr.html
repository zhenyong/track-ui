<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">&quot;use strict&quot;;
// @tag class
<span id='Tk-ClassMgr'>/**
</span> * @class Tk.ClassMgr
 */
Tk.ClassMgr = (function() {

	var makeCtor = Tk.Class.makeCtor,
		Manager = Tk.apply(new Tk.Inventory(), {

<span id='Tk-method-define'>		/**
</span>         * 定义或者扩展一个类
         * 
         * @param {String} className 以点分割的类名, 如 &#39;Tk.widget.Dialog&#39;
         * 
         * 命名建议:
         *  - 根部和类名使用驼峰命名
         *  - 其他部分使用小写
         * 传入 `null` 表示创建一个匿名类
         * @param {Object} data 转化到类上的 键-值 对. 禁止自定义下列属性名：
         * //TODO
         * @param {Function} [createdFn] 创建完类之后的回调, 执行作用域(`this`) 指向新创建的类本身.
         * @return {Object}
         * @member Tk
         */
		define: function(className, data, createdFn) {
			//TODO 暂时不管 override 的情况
			// if (data.override) {
			// 	Manager.classState[className] = 20;
			// 	return Manager.createOverride.apply(Manager, arguments);
			// }

			// Manager.classState[className] = 10;
			return Manager.create.apply(Manager, arguments);
		},

<span id='Tk-ClassMgr-method-create'>        /**
</span>         * 定义一个类（非继承类）
         * @private
         */
        create: function(className, data, createdFn) {

            var ctor = makeCtor(className);
            if (typeof data === &#39;function&#39;) {
                data = data(ctor);
            }

            //&lt;debug&gt;
            if (className) {
                if (Manager.classes[className]) {
                    Tk.log.warn(&quot;[Tk.define] Duplicate class name &#39;&quot; + className + &quot;&#39; specified, must be a non-empty string&quot;);
                }
                ctor.name = className;
            }
            //&lt;/debug&gt;

            data.$className = className;

            return new Class(ctor, data, function() {
                var postprocessorStack = data.postprocessors || Manager.defaultPostprocessors,
                    registeredPostprocessors = Manager.postprocessors,
                    postprocessors = [],
                    postprocessor, i, ln, j, subLn, postprocessorProperties, postprocessorProperty;

                delete data.postprocessors;

                for (i = 0,ln = postprocessorStack.length; i &lt; ln; i++) {
                    postprocessor = postprocessorStack[i];

                    if (typeof postprocessor === &#39;string&#39;) {
                        postprocessor = registeredPostprocessors[postprocessor];
                        postprocessorProperties = postprocessor.properties;

                        if (postprocessorProperties === true) {
                            postprocessors.push(postprocessor.fn);
                        }
                        else if (postprocessorProperties) {
                            for (j = 0,subLn = postprocessorProperties.length; j &lt; subLn; j++) {
                                postprocessorProperty = postprocessorProperties[j];

                                if (data.hasOwnProperty(postprocessorProperty)) {
                                    postprocessors.push(postprocessor.fn);
                                    break;
                                }
                            }
                        }
                    }
                    else {
                        postprocessors.push(postprocessor);
                    }
                }

                data.postprocessors = postprocessors;
                data.createdFn = createdFn;
                Manager.processCreate(className, this, data);
            });
        }
	});

	return Manager;

})(Tk.Class, Tk.Function.alias, Array.prototype.slice, Tk.Array.from, Tk.global);</pre>
</body>
</html>
